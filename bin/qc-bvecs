#!/usr/bin/env python
"""
Computes the number of BVALs and B0s for the input scan, and plots the DTI
directions  (BVECs) as a 3D scatterplot.

Usage:
    qc-bvecs <bvec> <bval> <output>

Arguments:
    <bvec>            Input bvec file
    <bval>            Input bval file
    <output>          Output .csv file
"""

import os,sys
from copy import copy
import numpy as np

import matplotlib
matplotlib.use('Agg')   # Force matplotlib to not use any Xwindows backend
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

def main(bvec, bval, output):

    bvecName = copy(bvec)
    bvec = np.genfromtxt(bvec)
    bval = np.genfromtxt(bval)

    idxDirs = np.where(bval > 0)[0]

    nDirs = len(idxDirs)
    nB0s = len(bval) - len(idxDirs)

    # 3d scatterplot of directions
    fig = plt.figure()
    ax = fig.add_subplot(111, projection='3d')
    ax.scatter(bvec[0, idxDirs], bvec[1, idxDirs], bvec[2, idxDirs])
    plt.savefig(bvecName + '.png')

    with open(output, 'wb') as f:
        f.write('#ndirs,nb0s\n{},{}'.format(nDirs, nB0s))

if __name__ == '__main__':
    if len(sys.argv) == 4:
        main(sys.argv[1], sys.argv[2], sys.argv[3])
    else:
        print(__doc__)

